!function(){"use strict";function e(e,t){return function(...n){let i=e.bind(this);if(1!=t(n,i,e,this))return i(...n)}}function t(e,t,n=!1){let i=0,s=Date.now(),r=null,a=()=>{i++;try{return e(i,Date.now()-s),void(null!=r&&clearInterval(r))}catch(e){}};r=setInterval(a,t),n&&a()}function n(e,t){let n=e;return t.every((e=>(e<0&&(e+=n.childNodes.length),!!n.childNodes[e]&&(n=n.childNodes[e],!0)))),n}let i={iframeWindow:null,iframeDocument:null,socket:null,iframeBody:null,socketApi:{send:()=>{}}};const s=Symbol("serialization function"),r=Symbol("deserialization function"),a=new Set;[Set,Map].forEach((e=>{a.add(e)}));const o=new TextEncoder,l=new TextDecoder("utf-8");class c{arr=new Uint8Array(128);endInd=0;push(e){if(this.endInd>=this.arr.length){let e=this.arr;this.arr=new Uint8Array(2*this.arr.length),this.arr.set(e)}this.arr[this.endInd++]=e}pushArr(e){if(this.endInd+e.length>this.arr.length){let t=this.arr,n=2*t.length;for(;this.endInd+e.length>n;)n*=2;this.arr=new Uint8Array(n),this.arr.set(t)}this.arr.set(e,this.endInd),this.endInd+=e.length}}const d=new class e{nameToClass=new Map;classToName=new Map;nameToSFunction=new Map;sFunctionToName=new Map;addClass(e,t){this.nameToClass.set(e,t),this.classToName.set(t,e)}addSafetyFunction(e,t){this.nameToSFunction.set(e,t),this.sFunctionToName.set(t,e)}encode(t){let n=new c;const i=e=>{for(;;){let t=127&e;if(!(e>>>=7))return void n.push(128|t);n.push(t)}},r=e=>{let t=o.encode(e);i(t.byteLength),n.pushArr(t)};let l=-1,d=new Map;const h=t=>{switch(++l,d.has(t)||d.set(t,l),typeof t){case"number":Number.isInteger(t)?(n.push(1),i(t)):(n.push(2),n.pushArr(new Uint8Array(new Float64Array([t]).buffer)));break;case"string":n.push(3),r(t);break;case"object":if(null==t)n.push(11);else if(d.get(t)<l)n.push(14),i(d.get(t));else if(Array.isArray(t))n.push(5),t.forEach(h),n.push(0);else if(this.classToName.has(Object.getPrototypeOf(t)?.constructor)){n.push(6),r(this.classToName.get(Object.getPrototypeOf(t)?.constructor));let e=t[s]?t[s].call(t):t,a=Object.getOwnPropertyNames(e);i(a.length),a.forEach((t=>{r(t),h(e[t])}))}else if(a.has(Object.getPrototypeOf(t)?.constructor))switch(n.push(15),Object.getPrototypeOf(t)?.constructor){case Map:i(1),i(t.size),t.forEach(((e,t)=>{h(t),h(e)}));break;case Set:i(2),t.forEach(h),n.push(0);break;default:n.push(7)}else{n.push(4);let e=Object.keys(t);i(e.length),e.forEach((e=>{r(e),h(t[e])}))}break;case"undefined":n.push(7);break;case"boolean":n.push(t?9:8);break;case"bigint":{let s=null;t>=0n?(n.push(12),s=t>0n?e.writeBigint(t):new Uint8Array(0)):(n.push(13),s=e.writeBigint(-t)),i(s.byteLength),n.pushArr(s);break}case"symbol":d.get(t)<l?(n.push(14),i(d.get(t))):(n.push(10),r(t.description?t.description:""));break;case"function":this.sFunctionToName.has(t)?(n.push(17),r(this.sFunctionToName.get(t))):n.push(7);break;default:throw"JSObin(encode): The type of value that cannot be processed."}};return h(t),n.arr.slice(0,n.endInd)}decode(t){let n=new DataView(t.buffer),i=0;const s=()=>{let e=0,n=0;for(;!(128&t[i]);)if(e|=t[i++]<<n,n+=7,n>32)throw"JSOBin Decode: Unexpected vint length";return e|=(127&t[i++])<<n,e},a=()=>{let e=s(),n=l.decode(t.subarray(i,i+e));return i+=e,n};let o=[];const c=l=>{if(i>=t.length)throw"JSOBin Decode: Wrong format";switch(void 0===l?t[i++]:l){case 1:{let e=s();return o.push(e),e}case 2:{let e=n.getFloat64(i,!0);return o.push(e),i+=8,e}case 3:{let e=a();return o.push(e),e}case 4:{let e={},t=s();o.push(e);for(let n=0;n<t;n++){e[a()]=c()}return e}case 5:{let e=[];for(o.push(e);t[i];)e.push(c());return i++,e}case 6:{let e=a(),t=this.nameToClass.get(e);if(null==t)throw`JSOBin Decode: (class) "${e}" is unregistered class in the current context in the parsing jsobin`;if(t?.[r]){let e=Object.create(t.prototype),n=s();o.push(e);for(let t=0;t<n;t++){e[a()]=c()}return t[r](e)}{let e=Object.create(t.prototype),n=s();o.push(e);for(let t=0;t<n;t++){e[a()]=c()}return e}}case 7:return void o.push(void 0);case 8:return o.push(!1),!1;case 9:return o.push(!0),!0;case 10:{let e=Symbol(a());return o.push(e),e}case 11:return o.push(null),null;case 12:{let n=s(),r=e.readBigInt(t,i,n);return o.push(r),i+=n,r}case 13:{let n=s(),r=e.readBigInt(t,i,n);return o.push(r),i+=n,-r}case 14:{let e=s(),t=o[e];return o.push(t),t}case 15:switch(s()){case 1:{let e=new Map,t=s();o.push(e);for(let n=0;n<t;n++){let t=c();e.set(t,c())}return e}case 2:{let e=new Set;for(o.push(e);t[i];)e.add(c());return i++,e}default:throw"JSOBin Decode: Unsupported js built-in class type."}case 16:throw"JSOBin Decode: Function is not supported in the current version";case 17:{let e=this.nameToSFunction.get(a());return o.push(e),e}default:throw"JSOBin Decode: Wrong format"}};return c()}static writeBigint(e){let t=[];for(;;)if(t.push(Number(e&BigInt(255))),0n==(e>>=8n))return new Uint8Array(t)}static readBigInt(e,t,n){let i=0n;for(let s=t+n-1;s>=t;s--)i<<=8n,i+=BigInt(e[s]);return i}};function h(e){if(e.startsWith("iiroseForge:")&&e.endsWith(":end")){let t=e.slice(12,-4);try{let e=t.indexOf(","),n=Number.parseInt(t.slice(0,e),36);if(Number.isNaN(n)||n<0||n>8192)return;t=t.slice(e+1);let i=t.slice(0,n);if(i.length!=n)return;let s=t.slice(n).split(",");if(!s[1]||"single"==s[1])return d.decode(function(e){let t=window.atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(i))}catch(e){return void console.log(e)}}}function u(e){try{let t=function(e){let t=Array.from(e).map((e=>String.fromCharCode(e))).join("");return window.btoa(t)}(d.encode(e)),n=["","single"];return`iiroseForge:${t.length.toString(36)},${t}${n.join(",")}:end`}catch(e){return}}const p={diFull:e=>"calc(100% - "+e+")",rgb:(e,t,n,i=1)=>"rgba("+e+", "+t+", "+n+", "+i+")"};function f(e,t){if(!e)return!1;for(let n=0,i=e.length;n<i;n++)if(null!=e[n]&&t(e[n],n))return!0;return!1}const g=new WeakMap,m=new FinalizationRegistry((e=>{e.destroy()}));class b{proxyObj=null;srcObj=null;keys=[];hookMap=null;ctFunc=null;constructor(e,t,n,i,s){this.proxyObj=e,this.srcObj=t,this.keys=n,this.hookMap=i,this.ctFunc=s}getValue(){return this.ctFunc?this.ctFunc(...this.keys.map((e=>this.srcObj[e]))):this.srcObj[this.keys[0]]}addHook(e){this.keys.forEach((t=>{let n=this.hookMap.get(t);null==n&&(n=new Set,this.hookMap.set(t,n)),n.add(e)}))}removeHook(e){this.keys.forEach((t=>{let n=this.hookMap.get(t);n&&(n.delete(e),0==n.size&&this.hookMap.delete(t))}))}bindToValue(e,t){return new w(this,e,t)}bindToCallback(e){return new y(this,e)}}class y{info=null;cbRef=null;callback=null;constructor(e,t){this.info=e,this.cbRef=new WeakRef(t),this.callback=t,e.addHook(this)}emit(){let e=this.cbRef.deref();if(e)try{e(this.info.getValue())}catch(e){console.error(e)}}destroy(){this.info.removeHook(this),m.unregister(this)}bindDestroy(e){let t=g.get(e);return null==t&&(t=new Set,g.set(e,t)),t.add(this.callback),this.callback=null,m.register(e,this,this),this}}class w{info=null;targetRef=null;targetKey="";constructor(e,t,n){this.info=e,this.targetRef=new WeakRef(t),this.targetKey=n,e.addHook(this),m.register(t,this,this)}emit(){let e=this.targetRef.deref();if(null!=e)try{e[this.targetKey]=this.info.getValue()}catch(e){console.error(e)}}destroy(){this.info.removeHook(this),m.unregister(this)}}const x=Symbol("NElement");class v{element=null;styleHooks=new Map;constructor(e){this.element=e}addChild(e){e instanceof v?this.element.appendChild(e.element):this.element.appendChild(e)}addChilds(...e){e.forEach((e=>{Array.isArray(e)?e.forEach((e=>this.addChild(e))):"object"==typeof e&&this.addChild(e)}))}insChild(e,t){let n=this.element;"number"==typeof t?t>=0||t<n.childElementCount?n.insertBefore(e.element,n.children[t]):t<0||t>=-n.childElementCount?n.insertBefore(e.element,n.children[n.childElementCount+t]):n.appendChild(e.element):n.insertBefore(e.element,t.element)}childInd(e){let t=-1;return f(this.element.children,((n,i)=>{if(n==e.element)return t=i,!0})),t}remove(){this.element.remove()}removeChilds(e=0,t=1/0){let n=this.element;t>n.childElementCount&&(t=n.childElementCount);for(let i=e;i<t;i++)n.children[e].remove()}getChilds(){return Array.from(this.element.children).map((e=>k(e)))}getChild(e){return k(this.element.children[e])}setStyle(e,t,n){n!=this.styleHooks.get(e)&&(this.styleHooks.get(e)?.destroy(),null!=n?this.styleHooks.set(e,n):this.styleHooks.delete(e)),t instanceof b?t.bindToCallback((t=>{this.setStyle(e,t,n)})).bindDestroy(this).emit():this.element.style[e]=t}getStyle(e){if("string"==typeof e)return this.element.style[e]}setStyles(e){f(Object.keys(e),(t=>{(function(e,...t){return f(t,(t=>t==e))})(typeof e[t],"number","string")&&(this.element.style[t]=e[t])}))}setText(e){this.element.innerText=e}addText(e){return this.element.appendChild(document.createTextNode(e))}setAttrs(e){f(Object.keys(e),(t=>{this.element[t]=e[t]}))}setDisplay(e){this.setStyle("display",e)}addEventListener(e,t,n){this.element.addEventListener(e,t,n)}removeEventListener(e,t,n){this.element.removeEventListener(e,t,n)}animate(e,t){this.element.animate(e,t)}asse(e){return e(this),this}getTagName(){return this.element.tagName.toLowerCase()}static byElement(e){return e[x]?e[x]:e[x]=new v(e)}}function k(e){return v.byElement(e)}function S(e){let t=k(document.createElement(e.tagName?e.tagName:"div"));return["height","width","position","top","left","right","bottom","display","overflow"].forEach((n=>{e[n]&&t.setStyle(n,e[n])})),e.style&&t.setStyles(e.style),e.text&&t.setText(e.text),e.attr&&t.setAttrs(e.attr),e.classList&&t.element.classList.add(...e.classList),e.event&&Object.keys(e.event).forEach((n=>{e.event[n]&&t.addEventListener(n,e.event[n])})),e.child&&e.child.forEach((e=>{e&&(e instanceof v?t.addChild(e):t.addChild(S(e)))})),e.assembly&&e.assembly.forEach((e=>{let n=e(t);n&&(t=n)})),t}function M(e,t){let n={},i={};return Object.keys(t).forEach((e=>n[e]=t[e])),Object.keys(e).forEach((s=>{if("child"!=s)if("$"==s[0]){let r=s.slice(1);i[r]=t[r],n[r]=t[r]=e[s]}else if("$"==s.slice(-1)){let n=s.slice(0,-1);i[n]=t[n],t[n]=e[s]}else n[s]=e[s]})),n.left&&n.right&&n.width&&delete n.width,n.top&&n.bottom&&n.height&&delete n.height,e.child&&(n.child=[],e.child.forEach((e=>{e&&(e instanceof v?n.child.push(e):n.child.push(M(e,t)))}))),Object.keys(i).forEach((e=>t[e]=i[e])),n}function F(e){return S(M(e,{}))}class I{eventName=null;callback=null;constructor(e,t){this.eventName=e,this.callback=t}apply(e){e.addEventListener(this.eventName,this.callback)}}class E{callback=null;constructor(e){this.callback=e}apply(e){this.callback(e)}}class C{key=null;value=null;constructor(e,t){this.key=e,this.value=t}apply(e){if("function"==typeof this.value){let t=this.value(e.element[this.key]);null!=t&&(e.element[this.key]=t)}else e.element[this.key]=this.value}}class L{tagName=null;constructor(e){this.tagName=e.toLowerCase()}}class P{list=null;flatFlag=!1;constructor(e){this.list=e}apply(e){const t=e.getTagName();this.list.forEach((n=>{if("string"==typeof n)e.addText(n);else switch(Object.getPrototypeOf(n)?.constructor){case b:{const t=n,i=e.addText(t.getValue());t.bindToValue(i,"data");break}case L:if(t!=n.tagName)throw"(NList) The feature tagName does not match the element";break;case j:case C:case I:case E:n.apply(e);break;case v:e.addChild(n);break;case P:{const t=n;t.flatFlag?t.apply(e):e.addChild(t.getElement());break}case Array:e.addChild(P.getElement(n));break;default:throw"(NList) Untractable feature types were found"}}))}getTagName(){let e="";return this.list.forEach((t=>{let n="";if(t instanceof L?n=t.tagName:t instanceof P&&t.flatFlag&&(n=t.getTagName()),n)if(e){if(e!=n)throw"(NList) Multiple TagNames exist in a feature list"}else e=n})),e}getElement(){let e=this.getTagName();""==e&&(e="div");let t=k(document.createElement(e));return this.apply(t),t}static flat(e){let t=new P(e);return t.flatFlag=!0,t}static getElement(e){return new P(e).getElement()}}class j{key=null;value=null;constructor(e,t){this.key=e,this.value=t}apply(e){e.setStyle(this.key,this.value)}}function O(e,t){return new j(e,t)}function A(e){return P.flat(Object.keys(e).map((t=>new j(t,e[t]))))}class T{x=0;y=0;vx=0;vy=0;sx=0;sy=0;hold=!1;pressing=!1;constructor(e,t,n,i,s,r,a,o){this.x=e,this.y=t,this.vx=n,this.vy=i,this.sx=s,this.sy=r,this.hold=a,this.pressing=o}}function N(e,t,n=0){e.addEventListener("mousedown",(e=>function(e){e.cancelable&&e.preventDefault();o=r=e.clientX,l=a=e.clientY,window.addEventListener("mousemove",i,!0),window.addEventListener("mouseup",s,!0),e.button==n&&(c=!0,t(new T(r,a,0,0,r,a,!0,!0)))}(e)),!1);let i=e=>function(e){if(c){let n=e.clientX-r,i=e.clientY-a;r=e.clientX,a=e.clientY,t(new T(r,a,n,i,o,l,!0,!1))}}(e),s=e=>function(e){let d=e.clientX-r,h=e.clientY-a;r=e.clientX,a=e.clientY,window.removeEventListener("mousemove",i,!1),window.removeEventListener("mouseup",s,!1),c&&e.button==n&&(c=!1,t(new T(r,a,d,h,o,l,!1,!1)))}(e),r=0,a=0,o=0,l=0,c=!1}function B(e,t){e.addEventListener("touchstart",(e=>function(e){e.cancelable&&e.preventDefault();f(e.changedTouches,(e=>{let i={id:e.identifier,sx:e.clientX,sy:e.clientY,x:e.clientX,y:e.clientY};n.push(i),t(new T(i.x,i.y,0,0,i.sx,i.sy,!0,!0))}))}(e)),{capture:!1,passive:!1}),e.addEventListener("touchmove",(e=>function(e){f(e.changedTouches,(e=>{let s=i(e.identifier);if(s>-1){let i=n[s],r=e.clientX-i.x,a=e.clientY-i.y;i.x=e.clientX,i.y=e.clientY,t(new T(i.x,i.y,r,a,i.sx,i.sy,!0,!1))}}))}(e)),{capture:!1,passive:!0}),e.addEventListener("touchend",(e=>function(e){e.changedTouches,f(e.changedTouches,(e=>{let s=i(e.identifier);if(s>-1){let i=n[s];n.splice(s,1);let r=e.clientX-i.x,a=e.clientY-i.y;i.x=e.clientX,i.y=e.clientY,t(new T(i.x,i.y,r,a,i.sx,i.sy,!1,!1))}}))}(e)),{capture:!1,passive:!0});let n=[];function i(e){let t=-1;return n.forEach(((n,i)=>{e==n.id&&(t=i)})),t}}let W=k(document.body);function z(e){e.setStyle("transition","transform 50ms linear, text-shadow 150ms linear"),e.addEventListener("mousedown",(()=>{e.setStyle("transform","scale(0.95) translateY(2px)")})),e.addEventListener("mouseup",(()=>{e.setStyle("transform","")})),e.addEventListener("mouseenter",(()=>{e.setStyle("textShadow",`0 0 0.3em ${p.rgb(255,255,255,.5)}`),e.setStyle("transform","translateY(-1px)")})),e.addEventListener("mouseleave",(()=>{e.setStyle("textShadow",""),e.setStyle("transform","")}))}W.setStyle("cursor","default");var H=F({position:"absolute",right:"0px",style:{userSelect:"none",pointerEvents:"none",zIndex:"30000"}});function D(e,t,n="iiroseForge",i=null){let s=F({style:{backgroundColor:p.rgb(255,255,255,.95),marginRight:"1em",marginTop:"1em",marginLeft:"1em",float:"right",clear:"both",overflow:"hidden hidden",padding:"1em",boxSizing:"border-box",minWidth:"180px",borderRadius:"0.2em",boxShadow:`${p.rgb(0,0,0,.5)} 5px 5px 10px`},position:"relative",child:[{tagName:"i",classList:["fa","fa-info-circle"]},{text:e,style:{fontSize:"1.2em",lineHeight:"1.5em",fontWeight:"bolder"}},{text:t},{text:n,style:{fontSize:"0.9em",float:"right"}},{text:"×",position:"absolute",right:"4px",top:"1px",assembly:[z],style:{fontSize:"25px",lineHeight:"1em"},event:{click:e=>{e.stopPropagation(),a()}}}]});H.addChild(s),s.animate([{transform:"translateX(180%) translateY(10%) scale(0.6)"},{}],{duration:180}),setTimeout((()=>{s.setStyle("pointerEvents","auto")}),180);let r=!1;function a(){r||(r=!0,s.setStyle("pointerEvents","none"),s.animate([{},{transform:"translateX(180%)"}],{duration:270,fill:"forwards"}),setTimeout((()=>{s.setStyle("visibility","hidden"),s.animate([{height:s.element.clientHeight+"px"},{marginTop:0,height:0,padding:0}],{duration:150,fill:"forwards"}),setTimeout((()=>{s.remove()}),150)}),270))}setTimeout((()=>{a()}),3900+Math.min(1e4,115*t.length)),i&&(s.asse(z),s.addEventListener("click",(()=>{r||(i(),a())})))}W.addChild(H);let R=class{cbList=[];onceCbList=[];add(e){this.cbList.push(e)}addOnce(e){this.onceCbList.push(e)}remove(e){let t=this.cbList.indexOf(e);t>-1?this.cbList.splice(t,1):(t=this.onceCbList.indexOf(e),t>-1&&this.onceCbList.splice(t,1))}removeAll(){this.cbList=[],this.onceCbList=[]}trigger(e){this.cbList.forEach((async t=>{t(e)})),this.onceCbList.forEach((async t=>{t(e)})),this.onceCbList=[]}};const U={state:{plug:null},operation:{showForgeNotice:(e,t)=>{D("插件提示",e=String(e),`插件 ${U.state.plug?.name}`,t)},getUserName:()=>i.iframeWindow?.myself2?i.iframeWindow.myself2:null,getUserUid:()=>i.iframeWindow?.uid?i.iframeWindow.uid:null,getUserRoomId:()=>i.iframeWindow?.roomn?i.iframeWindow.roomn:null,getUserProfilePictureUrl:()=>i.iframeWindow?.avatar2&&i.iframeWindow?.avatarconv?i.iframeWindow.avatarconv(i.iframeWindow.avatar2):null,getUserInputColor:()=>i.iframeWindow?.inputcolorhex?i.iframeWindow.inputcolorhex:null,sendRoomMessage:e=>{(e=String(e))&&i.socketApi.send(JSON.stringify({m:e,mc:U.operation.getUserInputColor(),i:String(Date.now()).slice(-5)+String(Math.random()).slice(-7)}))},sendRoomForgePacket:e=>{U.operation.sendRoomMessage(u(e))},sendPrivateMessageSilence:(e,t)=>{e=String(e),(t=String(t))&&e&&i.socketApi.send(JSON.stringify({g:e,m:t,mc:U.operation.getUserInputColor(),i:String(Date.now()).slice(-5)+String(Math.random()).slice(-7)}))},sendPrivateMessage:(e,t)=>{if(e=String(e),!((t=String(t))&&e&&i.iframeWindow?.msgfetch&&i.iframeWindow?.Variable?.pmObjJson&&i.iframeWindow?.Utils?.service?.buildPmHelper))return;let n=i.iframeDocument.getElementById("moveinput"),s=n.value,r=i.iframeWindow.pmFull;n.value=t,i.iframeWindow.pmFull=!0,i.iframeWindow.Variable.pmObjJson?.[e]||i.iframeWindow.Utils.service.buildPmHelper(1,e,e),i.iframeWindow.msgfetch(0,i.iframeWindow.Variable.pmObjJson?.[e],e,""),i.iframeWindow.pmFull=r,n.value=s},sendSelfPrivateMessageSilence:e=>{U.operation.sendPrivateMessageSilence(U.operation.getUserUid(),e)},giveALike:(e,t="")=>{e=String(e),t=String(t),e&&i.socketApi.send(`+*${e}${t?" "+t:""}`)},switchRoom:e=>{e=String(e),i.iframeWindow?.Objs?.mapHolder?.function?.roomchanger&&i.iframeWindow.Objs.mapHolder.function.roomchanger(e)},runTerminalCommand:e=>{!function(e){i.iframeWindow?.Probe?.init?.shellHolder&&i.iframeWindow?.Init?.movePanel(6);let t=n(i.iframeDocument.getElementById("shellHolder"),[2,0,-1,0]),s=t.value;t.value=e,t.oninput(null),t.dispatchEvent(new KeyboardEvent("keydown",{keyCode:13})),t.value=s}(e=String(e))},sendCurrentPageMessage:e=>{!function(e){var t=document.getElementById("moveinput"),n=t.value;t.value=e,t.oninput(null),document.getElementsByClassName("moveinputSendBtn")[0]?.onclick(null),t.value=n}(e=String(e))}},event:{roomMessage:new R,privateMessage:new R,selfPrivateMessage:new R,roomForgePacket:new R}};window.iiroseForgeApi=U;let V={debugMode:!1},$={send:e=>{i.socketApi.send(e)},clientSend:e=>{i.socket.send(e)},receive:e=>{i.socket._onmessage(e)}};function J(e){e=Boolean(e),V.debugMode=e,e?(window.fdb=$,i.iframeWindow&&(i.iframeWindow.fdb=$)):(window.fdb&&delete window.fdb,i.iframeWindow?.fdb&&delete i.iframeWindow.fdb)}let Y="https://qwq0.github.io/iiroseForge/l.js",X=`<script type="text/javascript" src="${Y}"><\/script>`;async function _(){let e=await caches.open("v"),t=await caches.match("/");if(t){let n=await t.text();if(n.indexOf(X)>-1)return;let i=n.lastIndexOf("</body></html>");if(-1==i)return;let s=n.slice(0,i)+X+n.slice(i);await e.put("/",new Response(new Blob([s],{type:"text/html"}),{status:200,statusText:"OK"}))}else{let t=["<!DOCTYPE html>","<html>","<head>","</head>","<body>","<script>","(async() => {",'let cache = await caches.open("v");','await cache.delete("/");','let cacheMainPage = await (await fetch("/",{cache:"no-cache"})).text();','let insertIndex = cacheMainPage.lastIndexOf("</body></html>");',"let newCacheMainPage = (insertIndex == -1 ? cacheMainPage : (cacheMainPage.slice(0, insertIndex) + `<script` + ",`\` type="text/javascript" src="${Y}"><\` + \`/script>\` + cacheMainPage.slice(insertIndex)));`,'await cache.put("/", new Response(new Blob([newCacheMainPage], { type: "text/html" }), { status: 200, statusText: "OK" }));',"location.reload();","})();","<\/script>","</body>","</html>"].join("");await e.put("/",new Response(new Blob([t],{type:"text/html"}),{status:200,statusText:"OK"}))}}"true"==localStorage.getItem("installForge")&&_();const K={iiroseForge:{plugInfo:[],sideLoadedScript:[],userRemark:{}}};function G(){try{let e=JSON.stringify(K.iiroseForge);localStorage.setItem("iiroseForge",e)}catch(e){D("错误","无法写入储存 这可能导致iiroseForge配置丢失")}}function q(e){let t=e.split(" ");return new E((e=>{t.forEach((t=>{e.element.classList.add(t)}))}))}function Q(e,t,n=!1,...i){return new Promise((s=>{var r=void 0,a=F({width:"100%",height:"100%",$position:"absolute",style:{userSelect:"none",backgroundColor:p.rgb(0,0,0,.7),alignItems:"center",justifyContent:"center",zIndex:"30001"},assembly:[e=>{e.animate([{opacity:.1},{opacity:1}],{duration:120})}],display:"flex",child:[{style:{border:"1px white solid",backgroundColor:p.rgb(255,255,255,.95),color:p.rgb(0,0,0),alignItems:"center",justifyContent:"center",flexFlow:"column",lineHeight:"35px",minHeight:"190px",minWidth:"280px",maxWidth:"95%",boxSizing:"border-box",padding:"20px",borderRadius:"7px",pointerEvents:"none"},assembly:[e=>{e.animate([{transform:"scale(0.9) translateY(-100px)"},{}],{duration:120}),setTimeout((()=>{e.setStyle("pointerEvents","auto")}),120)},e=>{r=e}],position$:"static",display:"flex",child:[{text:e},{text:t},...i,{text:"确定",assembly:[z],event:{click:()=>{o(),s(!0)}}},n?{text:"取消",assembly:[z],event:{click:()=>{o(),s(!1)}}}:null]}]});function o(){r.setStyle("pointerEvents","none"),r.animate([{},{transform:"scale(0.9) translateY(-100px)"}],{duration:120,fill:"forwards"}),a.animate([{opacity:1},{opacity:.1}],{duration:120,fill:"forwards"}),setTimeout((()=>{a.remove()}),120)}W.addChild(a)}))}async function Z(e,t,n=!1,i=""){var s=F({tagName:"input",assembly:[z],style:{textAlign:"center",margin:"15px"},attr:{value:i}});return s.addEventListener("keydown",(e=>{e.stopPropagation()}),!0),await Q(e,t,n,s)?s.element.value:void 0}function ee(e){if(1==e.classList.length&&"msg"==e.classList.item(0)){let t=String(e.dataset.id).split("_")[0],i=K.iiroseForge.userRemark[t];if(i){let t=n(e,[0,0,-1,-1]);t.appendChild(P.getElement([A({color:"white",position:"absolute",["right"!=t.style.float?"left":"right"]:"0px",bottom:"42px"}),i]).element)}}}class te{#e=new ne;addPath(e,t){this.#e.addPath(e,0,t)}matchPrefix(e){return this.#e.matchPrefix(e,0)}}class ne{#t=new Map;#n=null;addPath(e,t,n){if(t>=e.length)this.#n=n;else{let i=this.#t.get(e[t]);null==i&&(i=new ne,this.#t.set(e[t],i)),i.addPath(e,t+1,n)}}matchPrefix(e,t){if(t>=e.length)return this.#n?.("",e);{let n=this.#t.get(e[t]);return null!=n?n.matchPrefix(e,t+1):this.#n?.(e.slice(t),e)}}}let ie=new te,se=new te,re=[""];se.addPath('"',(e=>{re[0]='"'+e.split("<").reverse().map((e=>{let t=e.split(">");if("s"!=t[4]&&"'"!=t[3][0]){let e=t[8],n=t[2],i=t[3],s=h(i);if(null!=s)return void U.event.roomForgePacket.trigger({senderId:e,senderName:n,content:s});U.event.roomMessage.trigger({senderId:e,senderName:n,content:i})}return e})).filter((e=>null!=e)).reverse().join("<")})),se.addPath('""',(e=>{let t=U.operation.getUserUid();re[0]='""'+e.split("<").map((e=>{let n=e.split(">");if(""==n[6]){let e=n[1],i=n[2],s=n[4];n[1]!=t?U.event.privateMessage.trigger({senderId:e,senderName:i,content:s}):n[1]==t&&n[11]==t&&U.event.selfPrivateMessage.trigger({content:n[4]})}return e})).filter((e=>null!=e)).join("<")})),ie.addPath("{",((e,t)=>{try{let e=JSON.parse(t),n=JSON.stringify(e);"{"==n[0]&&(re[0]=n)}catch(e){}}));class ae{nameToClass=new Map;classToName=new Map;nameToSafetyFunction=new Map;safetyFunctionToName=new Map}const oe=Symbol("serialization function"),le=Symbol("deserialization function"),ce=new TextEncoder;class de{#i=null;buffer=new Uint8Array(128);endInd=0;referenceIndCount=-1;referenceIndMap=new Map;constructor(e){this.#i=e}push(e){if(this.endInd>=this.buffer.length){let e=this.buffer;this.buffer=new Uint8Array(2*this.buffer.length),this.buffer.set(e)}this.buffer[this.endInd++]=e}pushArr(e){if(this.endInd+e.length>this.buffer.length){let t=this.buffer,n=2*t.length;for(;this.endInd+e.length>n;)n*=2;this.buffer=new Uint8Array(n),this.buffer.set(t)}this.buffer.set(e,this.endInd),this.endInd+=e.length}pushVint(e){for(;;){let t=127&e;if(!(e>>>=7))return void this.push(128|t);this.push(t)}}pushStr(e){let t=ce.encode(e);this.pushVint(t.byteLength),this.pushArr(t)}traversal(e){switch(++this.referenceIndCount,this.referenceIndMap.has(e)||this.referenceIndMap.set(e,this.referenceIndCount),typeof e){case"number":Number.isInteger(e)&&e>=-2147483648&&e<=2147483647?(this.push(1),this.pushVint(e)):(this.push(2),this.pushArr(new Uint8Array(new Float64Array([e]).buffer)));break;case"string":this.push(3),this.pushStr(e);break;case"object":if(null==e)this.push(11);else if(this.referenceIndMap.get(e)<this.referenceIndCount)this.push(14),this.pushVint(this.referenceIndMap.get(e));else if(Array.isArray(e))this.push(5),e.forEach((e=>{this.traversal(e)})),this.push(0);else if(this.#i.classToName.has(Object.getPrototypeOf(e)?.constructor)){this.push(6),this.pushStr(this.#i.classToName.get(Object.getPrototypeOf(e)?.constructor));let t=e[oe]?e[oe].call(e):e,n=Object.getOwnPropertyNames(t);this.pushVint(n.length),n.forEach((e=>{this.pushStr(e),this.traversal(t[e])}))}else if(he.has(Object.getPrototypeOf(e)?.constructor)){this.push(15);let t=he.get(Object.getPrototypeOf(e)?.constructor);this.pushVint(t.typeId),t.encode(this,e)}else{this.push(4);let t=Object.keys(e);this.pushVint(t.length),t.forEach((t=>{this.pushStr(t),this.traversal(e[t])}))}break;case"undefined":this.push(7);break;case"boolean":this.push(e?9:8);break;case"bigint":{let t=null;e>=0n?(this.push(12),t=0n==e?new Uint8Array(0):de.writeBigint(e)):(this.push(13),t=de.writeBigint(-e)),this.pushVint(t.byteLength),this.pushArr(t);break}case"symbol":this.referenceIndMap.get(e)<this.referenceIndCount?(this.push(14),this.pushVint(this.referenceIndMap.get(e))):(this.push(10),this.pushStr(e.description?e.description:""));break;case"function":this.#i.safetyFunctionToName.has(e)?(this.push(17),this.pushStr(this.#i.safetyFunctionToName.get(e))):this.push(7);break;default:throw"JSObin(encode): The type of value that cannot be processed."}}getFinalBuffer(){return this.buffer.slice(0,this.endInd)}encode(e){return this.traversal(e),this.getFinalBuffer()}static writeBigint(e){let t=[];for(;;)if(t.push(Number(255n&e)),0n==(e>>=8n))return new Uint8Array(t)}}const he=new Map,ue=new Map;[{constructor:Map,typeId:1,encode:(e,t)=>{e.pushVint(t.size),t.forEach(((t,n)=>{e.traversal(n),e.traversal(t)}))},decode:e=>{let t=new Map,n=e.getVInt();e.referenceIndList.push(t);for(let i=0;i<n;i++){let n=e.traversal();t.set(n,e.traversal())}return t}},{constructor:Set,typeId:2,encode:(e,t)=>{t.forEach((t=>{e.traversal(t)})),e.push(0)},decode:e=>{let t=new Set;for(e.referenceIndList.push(t);0!=e.peekByte();)t.add(e.traversal());return e.index++,t}},{constructor:ArrayBuffer,typeId:20,encode:(e,t)=>{e.pushVint(t.byteLength),e.pushArr(new Uint8Array(t))},decode:e=>{let t=e.getVInt(),n=e.buffer.buffer.slice(e.index,e.index+t);return e.referenceIndList.push(n),e.index+=t,n}}].forEach((e=>{he.set(e.constructor,{typeId:e.typeId,encode:e.encode}),ue.set(e.typeId,e.decode)})),[{constructor:Int8Array,typeId:10},{constructor:Uint8Array,typeId:11},{constructor:Int16Array,typeId:12},{constructor:Uint16Array,typeId:13},{constructor:Int32Array,typeId:14},{constructor:Uint32Array,typeId:15},{constructor:BigInt64Array,typeId:16},{constructor:BigUint64Array,typeId:17},{constructor:Float32Array,typeId:18},{constructor:Float64Array,typeId:19}].forEach((e=>{he.set(e.constructor,{typeId:e.typeId,encode:(e,t)=>{let n=t.buffer,i=t.byteOffset,s=t.length;e.pushVint(i),e.pushVint(s),e.traversal(n)}}),ue.set(e.typeId,(t=>{let n=t.referenceIndList.length;t.referenceIndList.push(null);let i=t.getVInt(),s=t.getVInt(),r=t.traversal(),a=new e.constructor(r,i,s);return t.referenceIndList[n]=a,a}))}));const pe=new TextDecoder("utf-8");class fe{#i=null;buffer=null;dataView=null;index=0;referenceIndList=[];constructor(e,t){this.#i=e,this.buffer=t,this.dataView=new DataView(t.buffer)}peekByte(){return this.buffer[this.index]}popByte(){return this.buffer[this.index++]}getVInt(){let e=0,t=0;for(;!(128&this.peekByte());)if(e|=this.popByte()<<t,t+=7,t>32)throw"JSOBin Decode: Unexpected vint length";return e|=(127&this.popByte())<<t,e}getStr(){let e=this.getVInt(),t=pe.decode(this.buffer.subarray(this.index,this.index+e));return this.index+=e,t}traversal(){if(this.index>=this.buffer.length)throw"JSOBin Decode: Wrong format";switch(this.popByte()){case 1:{let e=this.getVInt();return this.referenceIndList.push(e),e}case 2:{let e=this.dataView.getFloat64(this.index,!0);return this.referenceIndList.push(e),this.index+=8,e}case 3:{let e=this.getStr();return this.referenceIndList.push(e),e}case 4:{let e={},t=this.getVInt();this.referenceIndList.push(e);for(let n=0;n<t;n++){e[this.getStr()]=this.traversal()}return e}case 5:{let e=[];for(this.referenceIndList.push(e);this.peekByte();)e.push(this.traversal());return this.index++,e}case 6:{let e=this.getStr(),t=this.#i.nameToClass.get(e);if(null==t)throw`JSOBin Decode: (class) "${e}" is unregistered class in the current context in the parsing jsobin`;if(t?.[le]){let e={},n=this.getVInt(),i=this.referenceIndList.length;this.referenceIndList.push(e);for(let t=0;t<n;t++){e[this.getStr()]=this.traversal()}let s=t[le](e);return this.referenceIndList[i]=s,s}{let e=Object.create(t.prototype),n=this.getVInt();this.referenceIndList.push(e);for(let t=0;t<n;t++){e[this.getStr()]=this.traversal()}return e}}case 7:return void this.referenceIndList.push(void 0);case 8:return this.referenceIndList.push(!1),!1;case 9:return this.referenceIndList.push(!0),!0;case 10:{let e=Symbol(this.getStr());return this.referenceIndList.push(e),e}case 11:return this.referenceIndList.push(null),null;case 12:{let e=this.getVInt(),t=this.readBigInt(e);return this.referenceIndList.push(t),t}case 13:{let e=this.getVInt(),t=this.readBigInt(e);return this.referenceIndList.push(t),-t}case 14:{let e=this.getVInt(),t=this.referenceIndList[e];return this.referenceIndList.push(t),t}case 15:{let e=this.getVInt(),t=ue.get(e);if(t)return t(this);throw"JSOBin Decode: Unsupported js built-in class type."}case 16:throw"JSOBin Decode: Function is not supported in the current version";case 17:{let e=this.#i.nameToSafetyFunction.get(this.getStr());return this.referenceIndList.push(e),e}default:throw"JSOBin Decode: Wrong format"}}decode(){return this.traversal()}readBigInt(e){let t=0n;for(let n=this.index+e-1;n>=this.index;n--)t<<=8n,t+=BigInt(this.buffer[n]);return this.index+=e,t}}class ge{once=!1;releaseTarget="";func=null;constructor(e,t,n){this.func=e,this.once=t,this.releaseTarget=n}}function me(e=2){var t=Math.floor(Date.now()).toString(36);for(let n=0;n<e;n++)t+="-"+Math.floor(1e12*Math.random()).toString(36);return t}let be=new class{#i=new ae;addClass(e,t){this.#i.nameToClass.set(e,t),this.#i.classToName.set(t,e)}addSafetyFunction(e,t){this.#i.nameToSafetyFunction.set(e,t),this.#i.safetyFunctionToName.set(t,e)}encode(e){return new de(this.#i).encode(e)}decode(e){return new fe(this.#i,e).decode()}};class ye{#s=new Map;#r=new Map;#a=new Map;#o=e=>{throw"RcoCcontext: not bound to an output stream"};#l=1;#c=null;constructor(){this.#c=new FinalizationRegistry((e=>{this.#a.delete(e),this.#d([2,e])}))}#d(e){switch(this.#l){case 0:this.#o(e);break;case 1:this.#o(be.encode(e));break;case 2:this.#o(function(e){let t=e.length,n="";for(let i=0;i<t;i++)n+=String.fromCharCode(e[i]);return btoa(n)}(be.encode(e)))}}bindOutStream(e,t="jsob"){if(this.#o=e,"raw"==t)this.#l=0;else if("jsob"==t||"jsobin"==t)this.#l=1;else{if("base64"!=t)throw"RcoCcontext(bindOutStream): Unsupported output stream types";this.#l=2}}addGlobalNamedFunctions(e){Object.keys(e).forEach((t=>{this.#s.set(t,e[t])}))}async#h(e){if(Array.isArray(e)){switch(e[0]){case 0:{let t=this.#s.get(e[1]);if(t){let n=e[3]?this.#u(e[2],e[3]).result:e[2];try{let i=await t(...n);if(e[4]){let t=this.#p(i);this.#d([1,e[4],[t.result],t.fnMap.size>0?t.fnMap:void 0])}}catch(t){e[5]&&this.#d([1,e[5],[t]])}}else e[5]&&this.#d([1,e[5],["function does not exist"]]);break}case 1:{let t=e[1],n=this.#r.get(t);if(n){let i=e[3]?this.#u(e[2],e[3]).result:e[2],s=n.func;n.once&&this.#r.delete(t),n.releaseTarget&&this.#r.delete(n.releaseTarget);try{let t=await s(...i);if(e[4]){let n=this.#p(t);this.#d([1,e[4],[n.result],n.fnMap.size>0?n.fnMap:void 0])}}catch(t){e[5]&&this.#d([1,e[5],[t]])}}else e[5]&&this.#d([1,e[5],["function does not exist"]]);break}case 2:e.slice(1).forEach((e=>{this.#r.delete(e)}))}}}onData(e){if("string"==typeof e)this.#h(be.decode(function(e){let t=atob(e),n=t.length,i=new Uint8Array(n);for(let e=0;e<n;e++)i[e]=t.charCodeAt(e);return i}(e)));else if(e instanceof Uint8Array)this.#h(be.decode(e));else{if("object"!=typeof e)throw"RcoCcontext(onData): Unable to process this data type";this.#h(e)}}callNamedFunction(e,...t){return new Promise(((n,i)=>{let s=this.#p(t),r=me(),a=me();this.#r.set(r,new ge(n,!0,a)),this.#r.set(a,new ge(i,!0,r)),this.#d([0,e,s.result,s.fnMap.size>0?s.fnMap:void 0,r,a])}))}getGlobalNamedFunctionProxy(){return new Proxy({},{set:()=>!1,get:(e,t)=>(...e)=>this.callNamedFunction(t,...e)})}#u(e,t){let n=new Map;t.forEach(((e,t)=>{if(!n.has(e)){let t=(...t)=>new Promise(((n,i)=>{let s=this.#p(t),r=me(),a=me();this.#r.set(r,new ge(n,!0,a)),this.#r.set(a,new ge(i,!0,r)),this.#d([1,e,s.result,s.fnMap.size>0?s.fnMap:void 0,r,a])}));n.set(e,t),this.#a.set(e,new WeakRef(t)),this.#c.register(t,e)}}));const i=e=>{if("object"==typeof e){if(t.has(e))return n.get(t.get(e));if(Array.isArray(e))return e.map(i);{let t={};return Object.keys(e).forEach((n=>{t[n]=i(e[n])})),t}}return e};return{result:i(e)}}#p(e){let t=new Map;const n=e=>{if("function"==typeof e){let n={},i=me();return this.#r.set(i,new ge(e,!1,"")),t.set(n,i),n}if("object"==typeof e){if(Array.isArray(e))return e.map(n);{let t={};return Object.keys(e).forEach((i=>{t[i]=n(e[i])})),t}}return e};return{result:n(e),fnMap:t}}}const we={version:"alpha v1.2.0"};let xe='!function(){"use strict";function e(e=2){var t=Math.floor(Date.now()).toString(36);for(let a=0;a<e;a++)t+="-"+Math.floor(1e12*Math.random()).toString(36);return t}function t(t,a){let r=new Map;let n=function t(n){if("function"==typeof n){let t={},s=e();return a.set(s,n),r.set(t,s),t}if("object"==typeof n){if(Array.isArray(n))return n.map(t);{let e={};return Object.keys(n).forEach((a=>{e[a]=t(n[a])})),e}}return n}(t);return{result:n,fnMap:r}}const a=new FinalizationRegistry((({id:e,port:t})=>{t.postMessage({type:"rF",id:e})}));function r(r,n,s,i,o){let p=new Map;n.forEach(((r,n)=>{if(!p.has(r)){let n=(...a)=>new Promise(((n,p)=>{let l=t(a,i),d=e();i.set(d,n),o.set(d,p),s.postMessage({type:"fn",id:r,param:l.result,fnMap:l.fnMap.size>0?l.fnMap:void 0,cb:d})}));p.set(r,n),a.register(n,{id:r,port:s})}}));const l=e=>{if("object"==typeof e){if(n.has(e))return p.get(n.get(e));if(Array.isArray(e))return e.map(l);{let t={};return Object.keys(e).forEach((a=>{t[a]=l(e[a])})),t}}return e};return{result:l(r)}}(()=>{let e=null,a=new Map,n=new Map;window.addEventListener("message",(s=>{"setMessagePort"==s.data&&null==e&&(e=s.ports[0],Object.defineProperty(window,"iframeSandbox",{configurable:!1,writable:!1,value:{}}),e.addEventListener("message",(async s=>{let i=s.data;switch(i.type){case"execJs":new Function(...i.paramList,i.js)(i.fnMap?r(i.param,i.fnMap,e,a,n).result:i.param);break;case"fn":if(a.has(i.id)){let s=i.fnMap?r(i.param,i.fnMap,e,a,n).result:i.param;try{let r=await a.get(i.id)(...s);if(i.cb){let n=t(r,a);e.postMessage({type:"sol",id:i.cb,param:[n.result],fnMap:n.fnMap.size>0?n.fnMap:void 0})}}catch(t){i.cb&&e.postMessage({type:"rej",id:i.cb,param:[t]})}}break;case"rF":a.delete(i.id);break;case"sol":{let t=i.fnMap?r(i.param,i.fnMap,e,a,n).result:i.param;a.has(i.id)&&a.get(i.id)(...t),a.delete(i.id),n.delete(i.id);break}case"rej":n.has(i.id)&&n.get(i.id)(...i.param),a.delete(i.id),n.delete(i.id)}})),e.start(),e.postMessage({type:"ready"}))})),window.addEventListener("load",(e=>{console.log("sandbox onload")}))})()}();';function ve(e=2){var t=Math.floor(Date.now()).toString(36);for(let n=0;n<e;n++)t+="-"+Math.floor(1e12*Math.random()).toString(36);return t}function ke(e,t){let n=new Map;let i=function e(i){if("function"==typeof i){let e={},s=ve();return t.set(s,i),n.set(e,s),e}if("object"==typeof i){if(Array.isArray(i))return i.map(e);{let t={};return Object.keys(i).forEach((n=>{t[n]=e(i[n])})),t}}return i}(e);return{result:i,fnMap:n}}const Se=new FinalizationRegistry((({id:e,port:t})=>{t.postMessage({type:"rF",id:e})}));function Me(e,t,n,i,s){let r=new Map;t.forEach(((e,t)=>{if(!r.has(e)){let t=(...t)=>new Promise(((r,a)=>{let o=ke(t,i),l=ve();i.set(l,r),s.set(l,a),n.postMessage({type:"fn",id:e,param:o.result,fnMap:o.fnMap.size>0?o.fnMap:void 0,cb:l})}));r.set(e,t),Se.register(t,{id:e,port:n})}}));const a=e=>{if("object"==typeof e){if(t.has(e))return r.get(t.get(e));if(Array.isArray(e))return e.map(a);{let t={};return Object.keys(e).forEach((n=>{t[n]=a(e[n])})),t}}return e};return{result:a(e)}}class Fe{cbList=[];onceCbList=[];add(e){this.cbList.push(e)}addOnce(e){this.onceCbList.push(e)}remove(e){let t=this.cbList.indexOf(e);t>-1?this.cbList.splice(t,1):(t=this.onceCbList.indexOf(e),t>-1&&this.onceCbList.splice(t,1))}removeAll(){this.cbList=[],this.onceCbList=[]}trigger(e){this.cbList.forEach((t=>{t(e)})),this.onceCbList.forEach((t=>{t(e)})),this.onceCbList=[]}}class Ie{#f=null;#g=null;#m=!1;#b=!1;#y=new AbortController;#w=new Fe;apiObj={};#x=new Map;#v=new Map;constructor(e=document.body){if(!("sandbox"in HTMLIFrameElement.prototype)||!Object.hasOwn(HTMLIFrameElement.prototype,"contentDocument"))throw"sandbox property are not supported";let t=document.createElement("iframe");t.sandbox.add("allow-scripts"),t.style.display="none",t.srcdoc=["<!DOCTYPE html>","<html>","<head>",'<meta charset="utf-8" />',"<title>iframe sandbox</title>",'<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />',"</head>","<body>","<script>",xe,"<\/script>","</body>","</html>"].join("");let n=new MessageChannel,i=n.port1;i.addEventListener("message",(async e=>{let t=e.data;switch(t.type){case"ready":this.#m=!0,this.#w.trigger();break;case"fn":if(this.#x.has(t.id)){let e=t.fnMap?Me(t.param,t.fnMap,i,this.#x,this.#v).result:t.param;try{let n=await this.#x.get(t.id)(...e);if(t.cb){let e=ke(n,this.#x);i.postMessage({type:"sol",id:t.cb,param:[e.result],fnMap:e.fnMap.size>0?e.fnMap:void 0})}}catch(e){t.cb&&i.postMessage({type:"rej",id:t.cb,param:[e]})}}break;case"rF":this.#x.delete(t.id);break;case"sol":{let e=t.fnMap?Me(t.param,t.fnMap,i,this.#x,this.#v).result:t.param;this.#x.has(t.id)&&this.#x.get(t.id)(...e),this.#x.delete(t.id),this.#v.delete(t.id);break}case"rej":this.#v.has(t.id)&&this.#v.get(t.id)(...t.param),this.#x.delete(t.id),this.#v.delete(t.id)}}),{signal:this.#y.signal}),t.addEventListener("load",(()=>{if(!this.#m&&!this.#b){if(t.contentDocument)throw"sandbox isolation failed";i.start(),t.contentWindow.postMessage("setMessagePort","*",[n.port2])}}),{signal:this.#y.signal}),e.appendChild(t),this.#f=t,this.#g=i}async waitAvailable(){return new Promise(((e,t)=>{this.#m?e():this.#w.addOnce(e)}))}async execJs(e){this.#m||await this.waitAvailable();let t=ke(this.apiObj,this.#x);this.#g.postMessage({type:"execJs",js:e,param:t.result,fnMap:t.fnMap.size>0?t.fnMap:void 0,paramList:["api"]})}get iframe(){return this.#f}destroy(){this.#b||(this.#b=!0,this.#f.remove(),this.#f=null,this.#y.abort(),this.#y=null,this.#g.close(),this.#g=null,this.#x=null,this.#v=null,this.#w.removeAll(),this.#w=null,this.#m=!1)}}const Ee={operation:{showForgeNotice:"显示forge通知",getUserName:"获取你的昵称",getUserUid:"获取你的uid",getUserRoomId:"获取所在房间id",getUserProfilePictureUrl:"获取你的头像",getUserInputColor:"获取你的主题色",sendRoomMessage:"在房间中发送信息",sendRoomForgePacket:"在房间中发送forge数据包",sendPrivateMessageSilence:"[危险]静默发送私聊消息",sendPrivateMessage:"[危险]发送私聊消息",sendSelfPrivateMessageSilence:"向自己静默发送私聊消息(同账号多设备间通信)",giveALike:"进行点赞",switchRoom:"切换所在房间"},event:{roomMessage:"接收房间消息",roomForgePacket:"接收房间forge数据包",privateMessage:"[危险]接收私聊消息",selfPrivateMessage:"接收自己(其他设备)发送给自己的私聊消息"}};function Ce(e=!1){let t=0,n=0,i=280,s=190,r=null,a=null,o=null,l=null,c=P.getElement([A({display:"none",position:"fixed",overflow:"hidden",border:"1px white solid",backgroundColor:"rgba(30, 30, 30, 0.85)",backdropFilter:"blur(2px)",color:"rgba(255, 255, 255)",alignItems:"center",justifyContent:"center",flexFlow:"column",lineHeight:"1.1em",boxSizing:"border-box",padding:"10px",borderRadius:"3px",pointerEvents:"none",resize:"both",boxShadow:"rgba(0, 0, 0, 0.5) 5px 5px 10px",zIndex:"20001",height:"190px",width:"280px"}),["plug-in",A({position:"absolute",left:"0",top:"0",right:"0",cursor:"move",lineHeight:"1.5em",backgroundColor:"rgba(100, 100, 100, 0.2)"}),new E((e=>{var i=0,s=0,r=e=>{e.hold?(e.pressing&&(i=t,s=n),t=i+e.x-e.sx,n=s+e.y-e.sy,t<0?t=0:t>=W.element.clientWidth-c.element.offsetWidth&&(t=W.element.clientWidth-c.element.offsetWidth),n<0?n=0:n>=W.element.clientHeight-c.element.offsetHeight&&(n=W.element.clientHeight-c.element.offsetHeight),c.setStyle("left",`${t}px`),c.setStyle("top",`${n}px`),l.setStyle("pointerEvents","none")):l.setStyle("pointerEvents","auto")};N(e,r),B(e,r)})),new I("touchend",(()=>{null!=r?(clearTimeout(r),r=null):a.setDisplay("block"),r=setTimeout((()=>{r=null,a.setDisplay("none")}),2500)}))],["-",A({position:"absolute",right:"4px",top:"1px",cursor:"default",fontSize:"1.5em",lineHeight:"1em"}),new I("click",(()=>{c.setDisplay("none")}))],[A({position:"absolute",top:"1.5em",bottom:"0",left:"0",right:"0",overflow:"auto"}),new E((e=>{o=e}))],[A({position:"absolute",right:"0.5px",bottom:"0.5px",height:"1.5em",aspectRatio:"1",cursor:"nwse-resize",display:"none",boxSizing:"border-box",borderRight:"0.75em blue solid",borderBottom:"0.75em blue solid",borderTop:"0.75em transparent solid",borderLeft:"0.75em transparent solid"}),new I("click",(()=>{c.setDisplay("none")})),new E((e=>{a=e})),new E((e=>{var t=0,n=0,r=e=>{e.hold?(e.pressing&&(t=i,n=s),i=t+e.x-e.sx,s=n+e.y-e.sy,c.setStyle("width",`${i}px`),c.setStyle("height",`${s}px`),l.setStyle("pointerEvents","none")):l.setStyle("pointerEvents","auto")};N(e,r),B(e,r)}))]]);W.addChild(c),new ResizeObserver((()=>{i=c.element.offsetWidth,s=c.element.offsetHeight,t>W.element.clientWidth-i&&c.setStyle("width",(i=W.element.clientWidth-t)+"px"),n>W.element.clientHeight-s&&c.setStyle("height",(s=W.element.clientHeight-n)+"px"),t<0&&(t=0,c.setStyle("left",`${t}px`)),n<0&&(n=0,c.setStyle("top",`${n}px`))})).observe(c.element);let d=null;return e?(l=k(document.createElement("iframe")),o.addChild(l)):(d=new Ie(o.element),l=k(d.iframe)),l.setStyles({display:"block",border:"none",height:"100%",width:"100%"}),{windowElement:c,sandbox:d,iframe:l}}async function Le(e,t,n){let{sandbox:i,windowElement:s}=function(){let e=Ce(!1);return{windowElement:e.iframe,sandbox:e.sandbox}}();await i.waitAvailable();let r=n?.operationPermissionSet?n?.operationPermissionSet:new Set,a=n?.eventPermissionSet?n?.eventPermissionSet:new Set,o={applyPermission:async(t,n)=>{if(t=t.filter((e=>Boolean(Ee.operation[e]))),n=n.filter((e=>Boolean(Ee.event[e]))),t.every((e=>r.has(e)))&&n.every((e=>a.has(e))))return!0;let i=await Q("权限申请",[`是否允许 ${e} 获取以下权限?`,...t.map((e=>"+ "+Ee.operation[e])),...n.map((e=>"+ "+Ee.event[e]))].join("\n"),!0);return i&&(t.forEach((e=>{Ee.operation[e]&&r.add(e)})),n.forEach((e=>{Ee.event[e]&&a.add(e)})),Pe.savePlugList()),!!i}};Object.keys(U.operation).forEach((t=>{Ee.operation[t]&&(o[t]=(...n)=>{if(r.has(t))try{U.state.plug={name:e};let i=U.operation[t](...n);return U.state.plug=null,i}catch(e){return void(U.state.plug=null)}})})),o.addEventListener=(e,t)=>{Ee.event[e]&&U.event[e]&&a.has(e)&&U.event[e].add(t)},i.apiObj={iiroseForge:o};let l="document.body.innerHTML='<div style=\"color:white\">network_error</div>';";try{l=await(await fetch(t)).text()}catch(e){}return i.execJs(l),{sandbox:i,windowElement:s,operationPermissionSet:r,eventPermissionSet:a}}const Pe=new class{map=new Map;async addPlug(e,t,n){this.map.has(e)||this.map.set(e,{url:t,...await Le(e,t,n)})}showPlugWindow(e){if(this.map.has(e)){let t=this.map.get(e).windowElement;t.setDisplay("block"),t.setStyle("pointerEvents","auto")}}removePlug(e){this.map.has(e)&&(this.map.get(e).sandbox.destroy(),this.map.delete(e))}savePlugList(){let e=[];this.map.forEach(((t,n)=>{e.push([n,t.url,Array.from(t.operationPermissionSet.values()),Array.from(t.eventPermissionSet.values())])})),K.iiroseForge.plugInfo=e,G()}readPlugList(){try{let e=K.iiroseForge.plugInfo;e.length>0&&(e.forEach((([e,t,n,i])=>{this.addPlug(e,t,{operationPermissionSet:new Set(n),eventPermissionSet:new Set(i)})})),D("iiroseForge plug-in",`已加载 ${e.length} 个插件`))}catch(e){}}};function je(e){return new Promise((t=>{var n=null,i=F({width:"100%",height:"100%",$position:"absolute",style:{userSelect:"none",backgroundColor:p.rgb(0,0,0,.7),alignItems:"center",justifyContent:"center",zIndex:"30001"},assembly:[e=>{e.animate([{opacity:.1},{opacity:1}],{duration:120})}],display:"flex",child:[{style:{border:"1px white solid",backgroundColor:p.rgb(255,255,255,.95),color:p.rgb(0,0,0),alignItems:"stretch",justifyContent:"center",flexFlow:"column",lineHeight:"45px",minHeight:"10px",minWidth:"280px",maxHeight:"100%",maxWidth:"95%",boxSizing:"border-box",padding:"10px",borderRadius:"7px",pointerEvents:"none"},assembly:[e=>{e.animate([{transform:"scale(0.9) translateY(-100px)"},{}],{duration:120}),setTimeout((()=>{e.setStyle("pointerEvents","auto")}),120),e.getChilds().forEach((e=>{e.addEventListener("click",s),z(e)}))},e=>{n=e}],position$:"static",overflow:"auto",child:e,event:{click:e=>{e.stopPropagation()}}}],event:{click:s}});function s(){n.setStyle("pointerEvents","none"),n.animate([{},{transform:"scale(0.9) translateY(-100px)"}],{duration:120,fill:"forwards"}),i.animate([{opacity:1},{opacity:.1}],{duration:120,fill:"forwards"}),setTimeout((()=>{i.remove()}),120)}W.addChild(i)}))}let Oe=null;function Ae(){let e=P.getElement([O("position","fixed"),O("top","0"),O("left","0"),O("zIndex","91000"),O("height","100%"),O("width","100%"),O("backgroundColor","rgba(255, 255, 255, 0.75)"),O("backdropFilter","blur(3px)"),[O("opacity","0.8"),O("backgroundColor","#303030"),O("width","100%"),O("boxShadow","0 0 1px rgb(0, 0, 0, 0.12), 0 1px 1px rgb(0, 0, 0, 0.24)"),O("zIndex","2"),O("fontFamily","md"),O("height","40px"),O("lineHeight","40px"),O("fontSize","26px"),O("padding","0 16px 0 16px"),O("whiteSpace","nowrap"),O("boxSizing","border-box"),O("position","relative"),O("color","#fff"),[q("mdi-anvil"),A({display:"inline",opacity:"0.8",backgroundColor:"#303030",boxShadow:"0 0 1px rgb(0,0,0,0.12), 0 1px 1px rgb(0,0,0,0.24)",zIndex:"2",fontFamily:"md",height:"40px",lineHeight:"40px",fontSize:"26px",padding:"0 0 0 0",whiteSpace:"nowrap",boxSizing:"border-box",position:"relative",color:"#fff"})],[O("display","inline"),O("fontSize","16px"),O("opacity","0.7"),O("fontWeight","bold"),O("marginLeft","16px"),O("height","100%"),O("lineHeight","40px"),O("display","inline"),O("verticalAlign","top"),`欢迎使用 iirose-Forge   version ${we.version}`]],[O("position","absolute"),O("width","100%"),O("top","40px"),O("bottom","40px"),[...[{title:"管理插件",text:"管理插件",icon:"puzzle",onClick:async()=>{je([P.getElement(["[ 添加插件 ]",new I("click",(async()=>{let e=await Z("添加插件","请输入插件地址\n插件会自动进行更新",!0);null!=e&&(await Pe.addPlug(e,e),Pe.savePlugList())}))]),...Array.from(Pe.map.keys()).map((e=>P.getElement([`${e}`,new I("click",(async()=>{je([P.getElement(["显示插件窗口",new I("click",(()=>{Pe.showPlugWindow(e)}))]),P.getElement(["移除插件",new I("click",(()=>{Pe.removePlug(e),Pe.savePlugList()}))])])}))])))])}},{title:"侧载脚本",text:"管理侧载js",icon:"script",onClick:async()=>{await Q("警告",["! 侧载外部脚本是高危操作 !","侧载的脚本不接受forge权限管理","外部脚本能获取您在此网站的所有信息","恶意外部脚本可能盗取您的账号","请勿加载他人提供的闭源脚本","继续操作前 您应该了解自己正在做什么"].join("\n")),je([P.getElement(["[ 添加iframe外侧侧载脚本 ]",new I("click",(async()=>{let e=await Z("添加侧载脚本","请输入脚本地址\n每次载入会重新获取脚本\n脚本将随forge启动运行",!0);null!=e&&(K.iiroseForge.sideLoadedScript.push([e,e,!1]),G(),D("添加侧载脚本","已将脚本添加到侧载列表\n将在下次重启时生效"))}))]),P.getElement(["[ 添加iframe内侧侧载脚本 ]",new I("click",(async()=>{let e=await Z("添加侧载脚本","请输入脚本地址\n每次载入会重新获取脚本\n脚本将随iframe重载运行",!0);null!=e&&(K.iiroseForge.sideLoadedScript.push([e,e,!0]),G(),D("添加侧载脚本","已将脚本添加到侧载列表\n将在下次重启或iframe重载时生效"))}))]),...K.iiroseForge.sideLoadedScript.map((([e,t,n],i)=>P.getElement([`${n?"内":"外"} | ${e}`,new I("click",(async()=>{je([P.getElement(["移除插件",new I("click",(()=>{K.iiroseForge.sideLoadedScript.splice(i,1),G(),D("删除侧载脚本","已将脚本从侧载列表移除\n将在下次重启时生效")}))])])}))])))])}},{title:"插件商店",text:"打开插件商店",icon:"shopping",onClick:async()=>{if(Oe)return Oe.windowElement.setDisplay("block"),void Oe.windowElement.setStyle("pointerEvents","auto");Oe=Ce(!0),Oe.iframe.element.src="https://iplugin.reifuu.icu";let e=new MessageChannel,t=e.port1,n=new ye;n.addGlobalNamedFunctions({getForgeVersion:async()=>we.version,getPlugList:async()=>Array.from(Pe.map.entries()).map((e=>({name:e[0],url:e[1].url}))),installPlug:async(e,t)=>3,uninstallPlug:async e=>3}),t.addEventListener("message",(e=>{n.onData(e)})),n.bindOutStream((e=>{t.postMessage(e)}),"raw"),Oe.iframe.addEventListener("load",(()=>{t.start(),Oe.iframe.element.contentWindow.postMessage({type:"setMessagePort",port:e.port2},"*",[e.port2])})),Oe.windowElement.setDisplay("block"),Oe.windowElement.setStyle("pointerEvents","auto")}},{title:"安装iiroseForge",text:"下次使用无需注入",icon:"puzzle",onClick:async()=>{localStorage.setItem("installForge","true"),_(),Q("安装iiroseForge","已完成")}},{title:"卸载iiroseForge",text:"下次启动清除iiroseForge",icon:"puzzle",onClick:async()=>{localStorage.removeItem("installForge"),async function(){let e=await caches.open("v"),t=await(await caches.match("/")).text(),n=t.indexOf(X);if(-1==n)return;let i=t.slice(0,n)+t.slice(n+X.length);await e.put("/",new Response(new Blob([i],{type:"text/html"}),{status:200,statusText:"OK"}))}(),Q("卸载iiroseForge","已完成")}}].map((e=>[q("commonBox"),O("maxWidth","calc(100% - 24px)"),O("minWidth","355.2px"),O("minHeight","200px"),O("float","left"),O("boxShadow","0 0 1px rgb(0,0,0,0.12),0 1px 1px rgb(0,0,0,0.24)"),O("margin","24px 12px 0px 12px"),O("position","relative"),[q("commonBoxHead"),O("backgroundColor","rgba(255,255,255,0.2)"),O("color","rgba(0,0,0,0.4)"),O("height","100px"),O("width","100%"),O("display","flex"),O("justifyContent","center"),O("padding","0 24px"),O("boxSizing","border-box"),[q("mdi-"+e.icon),O("lineHeight","100px"),O("fontSize","30px"),O("fontFamily","md"),O("display","inline-block"),O("verticalAlign","top"),O("height","100%"),O("opacity","0.7")],[O("lineHeight","100px"),O("fontSize","20px"),O("display","inline-block"),O("verticalAlign","top"),O("height","100%"),O("fontWeight","bold"),O("marginLeft","22px"),O("overflow","hidden"),O("whiteSpace","pre"),O("textOverflow","ellipsis"),e.title]],[q("textColor"),O("width","100%"),O("minHeight","100px"),O("backgroundColor","rgba(255,255,255,0.5)"),O("color","rgba(0,0,0,0.75)"),[O("fontWeight","bold"),O("width","100%"),O("height","100%"),O("lineHeight","1.8em"),O("textAlign","center"),O("padding","2.2em"),O("boxSizing","border-box"),O("whiteSpace","pre-wrap"),O("fontSize","16px"),O("color","rgba(0,0,0,0.7)"),e.text]],new I("click",e.onClick)]))]],[O("color","#303030"),O("background","#fff"),O("opacity","0.8"),O("display","flex"),O("height","40px"),O("position","absolute"),O("bottom","0"),O("width","100%"),O("boxShadow","0 0 1px rgb(0,0,0,0.12),0 1px 1px rgb(0,0,0,0.24)"),O("zIndex","2"),...[{text:"< 返回",onClick:()=>{e.remove()}}].map((e=>[O("width","0"),O("flexGrow","1"),O("justifyContent","center"),O("padding","0 24px"),O("boxSizing","border-box"),new I("click",e.onClick),[],[O("display","inline-block"),O("verticalAlign","top"),O("height","100%"),O("fontWeight","bold"),O("marginLeft","22px"),O("fontSize","14px"),O("lineHeight","40px"),O("overflow","hidden"),O("whiteSpace","pre"),O("textOverflow","ellipsis"),e.text]]))]]);return e.element.id="iiroseForgeMenu",e}function Te(){t((()=>{let t=document.getElementById("mainFrame"),n=t.contentWindow,s=t.contentDocument;if(!n.iiroseForgeInjected){if(null!=n.socket.__onmessage||null==n.socket._onmessage||null==n.socket._send)throw"main iframe is not ready";(()=>{let e=k(s.getElementById("functionHolder").childNodes[0]),t=function(){let e=P.getElement([O("background","#fff"),O("boxShadow","0 0 1px rgb(0,0,0,0.12),0 1px 1px rgb(0,0,0,0.24)"),O("position","relative"),O("zIndex","1"),O("color","#212121"),O("paddingLeft","16px"),O("paddingRight","56px"),O("transition","background-color 0.1s ease 0s, color 0.1s ease 0s"),O("cursor","url(images/cursor/2.cur), pointer"),O("width","100%"),O("height","56px"),O("boxSizing","border-box"),O("lineHeight","56px"),O("whiteSpace","nowrap"),new I("click",(()=>{i.iframeWindow?.functionHolderDarker?.click(),i.iframeBody.addChild(Ae())})),[new L("span"),new E((e=>e.element.classList.add("functionBtnIcon","mdi-anvil")))],[new L("span"),"Forge菜单",new E((e=>e.element.classList.add("functionBtnFont")))],[new L("span"),O("transform","rotate(-90deg)"),new E((e=>e.element.classList.add("functionBtnGroupIcon")))]]);return e.element.id="iiroseForgeMenuButton",e}();e.insChild(t,1)})(),i.iframeDocument=s,i.iframeWindow=n,i.iframeBody=k(s.body),i.socket=n.socket,i.socket._onmessage=e(i.socket._onmessage.bind(i.socket),(e=>{V.debugMode&&console.log("receive packet",e);try{if(re=t=e,se.matchPrefix(t[0]))return!0}catch(e){return console.error("[iiroseForge]",e),!1}var t;return!1})),i.socketApi.send=i.socket.send.bind(i.socket),i.socket.send=e(i.socketApi.send,(e=>{V.debugMode&&console.log("send packet",e);try{if(re=t=e,ie.matchPrefix(t[0]))return!0}catch(e){return console.error("[iiroseForge]",e),!1}var t;return!1})),n.iiroseForgeInjected=!0,console.log("[iiroseForge] 成功将iiroseForge注入iframe"),n.iiroseForgeApi=U,V.debugMode&&J(V.debugMode),(async()=>{let e=0;K.iiroseForge.sideLoadedScript.forEach((([t,n,i])=>{if(i){let t=document.createElement("script");t.src=n,s.body.appendChild(t),e++}})),e>0&&D("iiroseForge plug-in",`已在iframe内侧侧载 ${e} 个js脚本`)})(),function(){let t=i.iframeDocument.getElementsByClassName("msgholderBox")[0];new MutationObserver((e=>{for(let t of e)"childList"==t.type&&Array.from(t.addedNodes).forEach((e=>{null!=e.classList&&e.classList.contains("msg")&&ee(e)}))})).observe(t,{attributes:!1,childList:!0,subtree:!0,characterData:!0,characterDataOldValue:!0});let n=i.iframeWindow.Objs?.mapHolder?.function?.event;n&&(i.iframeWindow.Objs.mapHolder.function.event=e(n,(function(e,t,n,s){if(1==e.length&&7==e[0]){let n=s?.dataset?.uid;return!!n&&(t(...e),i.iframeDocument.getElementById("selectHolderBox").appendChild(P.getElement([q("selectHolderBoxItem selectHolderBoxItemIcon"),[q("mdi-account-cog"),A({fontFamily:"md",fontSize:"28px",textAlign:"center",lineHeight:"100px",height:"100px",width:"100px",position:"absolute",top:"0",opacity:".7",left:"0"})],"设置备注",[q("fullBox whoisTouch3")],new I("click",(async e=>{e.stopPropagation();let t=K.iiroseForge.userRemark[n],i=await Z("设置备注",`给 ${n} 设置备注`,!0,t||"");null!=i&&(K.iiroseForge.userRemark[n]=i,G())}))]).element),!0)}return!1})))}()}}),1e3),"true"==localStorage.getItem("installForge")&&t((()=>{let e=document.getElementById("mainFrame").contentWindow;if(e.iiroseForgeClearCacheInjected)return;if(!e.Utils?.service?.clearCache)throw"Incomplete load";let t=e.Utils.service.clearCache.bind(e.Utils.service);e.Utils.service.clearCache=(...n)=>{let i=e.parent.location._reload.bind(e.parent.location);e.location._reload=e.parent.location._reload=(...e)=>{setTimeout((async()=>{await _(),setTimeout((()=>{i(...e)}),5)}),100)},t(...n)},e.iiroseForgeClearCacheInjected=!0}),5)}if("iirose.com"==location.host)if("/"==location.pathname)if(window.iiroseForgeInjected)console.log("[iiroseForge] 已阻止重复注入");else{window.iiroseForgeInjected=!0,console.log("[iiroseForge] iiroseForge已启用"),window.enableForgeDebugMode=J,function(){try{let e=localStorage.getItem("iiroseForge");if(!e)return;let t=JSON.parse(e);Object.keys(t).forEach((e=>{K.iiroseForge[e]=t[e]}))}catch(e){D("错误","无法读入储存 这可能导致iiroseForge配置丢失")}}(),Pe.readPlugList(),document.getElementById("mainFrame").addEventListener("load",(()=>{console.log("[iiroseForge] 已重载 正在将iiroseForge注入iframe"),Te()})),console.log("[iiroseForge] 正在将iiroseForge注入iframe"),Te(),(async()=>{let e=0;K.iiroseForge.sideLoadedScript.forEach((([t,n,i])=>{if(!i){let t=document.createElement("script");t.src=n,window.document.body.appendChild(t),e++}})),e>0&&D("iiroseForge plug-in",`已在iframe外部侧载 ${e} 个js脚本`)})()}else if("/messages.html"==location.pathname){if(console.log("[iiroseForge] iiroseForge需要注入至主上下文中"),"iirose.com"==parent?.location?.host&&"/"==parent?.location?.pathname){let e=parent.document,t=e.createElement("script");t.src=Y,e.body.appendChild(t),console.log("[iiroseForge] 修正注入")}}else console.log("[iiroseForge] 已阻止注入 iiroseForge需要注入至根页面的主上下文中");else console.log("[iiroseForge] 已阻止注入 iiroseForge仅支持蔷薇花园(iirose.com)")}();
