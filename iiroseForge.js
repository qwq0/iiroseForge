!function(){"use strict";function e(e,t){return(...i)=>{if(1!=t(i,e))return e(...i)}}const t={diFull:e=>"calc(100% - "+e+")",rgb:(e,t,i,a=1)=>"rgba("+e+", "+t+", "+i+", "+a+")"};function i(e,t){if(!e)return!1;for(let i=0,a=e.length;i<a;i++)if(null!=e[i]&&t(e[i],i))return!0;return!1}const a=new WeakMap,n=new FinalizationRegistry((e=>{e.destroy()}));class s{proxyObj=null;srcObj=null;keys=[];hookMap=null;ctFunc=null;constructor(e,t,i,a,n){this.proxyObj=e,this.srcObj=t,this.keys=i,this.hookMap=a,this.ctFunc=n}getValue(){return this.ctFunc?this.ctFunc(...this.keys.map((e=>this.srcObj[e]))):this.srcObj[this.keys[0]]}addHook(e){this.keys.forEach((t=>{let i=this.hookMap.get(t);null==i&&(i=new Set,this.hookMap.set(t,i)),i.add(e)}))}removeHook(e){this.keys.forEach((t=>{let i=this.hookMap.get(t);i&&(i.delete(e),0==i.size&&this.hookMap.delete(t))}))}bindToValue(e,t){return new r(this,e,t)}bindToCallback(e){return new o(this,e)}}class o{info=null;cbRef=null;callback=null;constructor(e,t){this.info=e,this.cbRef=new WeakRef(t),this.callback=t,e.addHook(this)}emit(){let e=this.cbRef.deref();if(e)try{e(this.info.getValue())}catch(e){console.error(e)}}destroy(){this.info.removeHook(this),n.unregister(this)}bindDestroy(e){let t=a.get(e);return null==t&&(t=new Set,a.set(e,t)),t.add(this.callback),this.callback=null,n.register(e,this,this),this}}class r{info=null;targetRef=null;targetKey="";constructor(e,t,i){this.info=e,this.targetRef=new WeakRef(t),this.targetKey=i,e.addHook(this),n.register(t,this,this)}emit(){let e=this.targetRef.deref();if(null!=e)try{e[this.targetKey]=this.info.getValue()}catch(e){console.error(e)}}destroy(){this.info.removeHook(this),n.unregister(this)}}const l=Symbol("NElement");class c{element=null;styleHooks=new Map;constructor(e){this.element=e}addChild(e){e instanceof c?this.element.appendChild(e.element):this.element.appendChild(e)}addChilds(...e){e.forEach((e=>{Array.isArray(e)?e.forEach((e=>this.addChild(e))):"object"==typeof e&&this.addChild(e)}))}insChild(e,t){let i=this.element;"number"==typeof t?t>=0||t<i.childElementCount?i.insertBefore(e.element,i.children[t]):t<0||t>=-i.childElementCount?i.insertBefore(e.element,i.children[i.childElementCount+t]):i.appendChild(e.element):i.insertBefore(e.element,t.element)}childInd(e){let t=-1;return i(this.element.children,((i,a)=>{if(i==e.element)return t=a,!0})),t}remove(){this.element.remove()}removeChilds(e=0,t=1/0){let i=this.element;t>i.childElementCount&&(t=i.childElementCount);for(let a=e;a<t;a++)i.children[e].remove()}getChilds(){return Array.from(this.element.children).map((e=>d(e)))}getChild(e){return d(this.element.children[e])}setStyle(e,t,i){i!=this.styleHooks.get(e)&&(this.styleHooks.get(e)?.destroy(),null!=i?this.styleHooks.set(e,i):this.styleHooks.delete(e)),t instanceof s?t.bindToCallback((t=>{this.setStyle(e,t,i)})).bindDestroy(this).emit():this.element.style[e]=t}getStyle(e){if("string"==typeof e)return this.element.style[e]}setStyles(e){i(Object.keys(e),(t=>{(function(e,...t){return i(t,(t=>t==e))})(typeof e[t],"number","string")&&(this.element.style[t]=e[t])}))}setText(e){this.element.innerText=e}addText(e){return this.element.appendChild(document.createTextNode(e))}setAttrs(e){i(Object.keys(e),(t=>{this.element[t]=e[t]}))}setDisplay(e){this.setStyle("display",e)}addEventListener(e,t,i){this.element.addEventListener(e,t,i)}removeEventListener(e,t,i){this.element.removeEventListener(e,t,i)}animate(e,t){this.element.animate(e,t)}asse(e){return e(this),this}getTagName(){return this.element.tagName.toLowerCase()}static byElement(e){return e[l]?e[l]:e[l]=new c(e)}}function d(e){return c.byElement(e)}function h(e){let t=d(document.createElement(e.tagName?e.tagName:"div"));return["height","width","position","top","left","right","bottom","display","overflow"].forEach((i=>{e[i]&&t.setStyle(i,e[i])})),e.style&&t.setStyles(e.style),e.text&&t.setText(e.text),e.attr&&t.setAttrs(e.attr),e.classList&&t.element.classList.add(...e.classList),e.event&&Object.keys(e.event).forEach((i=>{e.event[i]&&t.addEventListener(i,e.event[i])})),e.child&&e.child.forEach((e=>{e&&(e instanceof c?t.addChild(e):t.addChild(h(e)))})),e.assembly&&e.assembly.forEach((e=>{let i=e(t);i&&(t=i)})),t}function p(e,t){let i={},a={};return Object.keys(t).forEach((e=>i[e]=t[e])),Object.keys(e).forEach((n=>{if("child"!=n)if("$"==n[0]){let s=n.slice(1);a[s]=t[s],i[s]=t[s]=e[n]}else if("$"==n.slice(-1)){let i=n.slice(0,-1);a[i]=t[i],t[i]=e[n]}else i[n]=e[n]})),i.left&&i.right&&i.width&&delete i.width,i.top&&i.bottom&&i.height&&delete i.height,e.child&&(i.child=[],e.child.forEach((e=>{e&&(e instanceof c?i.child.push(e):i.child.push(p(e,t)))}))),Object.keys(a).forEach((e=>t[e]=a[e])),i}function f(e){return h(p(e,{}))}class m{eventName=null;callback=null;constructor(e,t){this.eventName=e,this.callback=t}apply(e){e.addEventListener(this.eventName,this.callback)}}class u{key=null;value=null;constructor(e,t){this.key=e,this.value=t}apply(e){e.setStyle(this.key,this.value)}}function g(e,t){return new u(e,t)}class b{callback=null;constructor(e){this.callback=e}apply(e){this.callback(e)}}class y{key=null;value=null;constructor(e,t){this.key=e,this.value=t}apply(e){if("function"==typeof this.value){let t=this.value(e.element[this.key]);null!=t&&(e.element[this.key]=t)}else e.element[this.key]=this.value}}class w{tagName=null;constructor(e){this.tagName=e.toLowerCase()}}class x{list=null;flatFlag=!1;constructor(e){this.list=e}apply(e){const t=e.getTagName();this.list.forEach((i=>{if("string"==typeof i)e.addText(i);else switch(Object.getPrototypeOf(i)?.constructor){case s:{const t=i,a=e.addText(t.getValue());t.bindToValue(a,"data");break}case w:if(t!=i.tagName)throw"(NList) The feature tagName does not match the element";break;case u:case y:case m:case b:i.apply(e);break;case c:e.addChild(i);break;case x:{const t=i;t.flatFlag?t.apply(e):e.addChild(t.getElement());break}case Array:e.addChild(x.getElement(i));break;default:throw"(NList) Untractable feature types were found"}}))}getTagName(){let e="";return this.list.forEach((t=>{let i="";if(t instanceof w?i=t.tagName:t instanceof x&&t.flatFlag&&(i=t.getTagName()),i)if(e){if(e!=i)throw"(NList) Multiple TagNames exist in a feature list"}else e=i})),e}getElement(){let e=this.getTagName();""==e&&(e="div");let t=d(document.createElement(e));return this.apply(t),t}static flat(e){let t=new x(e);return t.flatFlag=!0,t}static getElement(e){return new x(e).getElement()}}let k={iframeWindow:null,iframeDocument:null,socket:null,iframeBody:null,socketApi:{send:e=>{k.socket.send(e)}}},v=d(document.body);v.setStyle("cursor","default");let M='<script type="text/javascript" src="https://qwq0.github.io/iiroseForge/l.js"><\/script>';let E='!function(){"use strict";function e(e=2){var t=Math.floor(Date.now()).toString(36);for(let a=0;a<e;a++)t+="-"+Math.floor(1e12*Math.random()).toString(36);return t}function t(t,a){let r=new Map;let n=function t(n){if("function"==typeof n){let t={},s=e();return a.set(s,n),r.set(t,s),t}if("object"==typeof n){if(Array.isArray(n))return n.map(t);{let e={};return Object.keys(n).forEach((a=>{e[a]=t(n[a])})),e}}return n}(t);return{result:n,fnMap:r}}const a=new FinalizationRegistry((({id:e,port:t})=>{t.postMessage({type:"rF",id:e})}));function r(r,n,s,i,o){let p=new Map;n.forEach(((r,n)=>{if(!p.has(r)){let n=(...a)=>new Promise(((n,p)=>{let l=t(a,i),d=e();i.set(d,n),o.set(d,p),s.postMessage({type:"fn",id:r,param:l.result,fnMap:l.fnMap.size>0?l.fnMap:void 0,cb:d})}));p.set(r,n),a.register(n,{id:r,port:s})}}));const l=e=>{if("object"==typeof e){if(n.has(e))return p.get(n.get(e));if(Array.isArray(e))return e.map(l);{let t={};return Object.keys(e).forEach((a=>{t[a]=l(e[a])})),t}}return e};return{result:l(r)}}(()=>{let e=null,a=new Map,n=new Map;window.addEventListener("message",(s=>{"setMessagePort"==s.data&&null==e&&(e=s.ports[0],Object.defineProperty(window,"iframeSandbox",{configurable:!1,writable:!1,value:{}}),e.addEventListener("message",(async s=>{let i=s.data;switch(i.type){case"execJs":new Function(...i.paramList,i.js)(i.fnMap?r(i.param,i.fnMap,e,a,n).result:i.param);break;case"fn":if(a.has(i.id)){let s=i.fnMap?r(i.param,i.fnMap,e,a,n).result:i.param;try{let r=await a.get(i.id)(...s);if(i.cb){let n=t(r,a);e.postMessage({type:"sol",id:i.cb,param:[n.result],fnMap:n.fnMap.size>0?n.fnMap:void 0})}}catch(t){i.cb&&e.postMessage({type:"rej",id:i.cb,param:[t]})}}break;case"rF":a.delete(i.id);break;case"sol":{let t=i.fnMap?r(i.param,i.fnMap,e,a,n).result:i.param;a.has(i.id)&&a.get(i.id)(...t),a.delete(i.id),n.delete(i.id);break}case"rej":n.has(i.id)&&n.get(i.id)(...i.param),a.delete(i.id),n.delete(i.id)}})),e.start(),e.postMessage({type:"ready"}))})),window.addEventListener("load",(e=>{console.log("sandbox onload")}))})()}();';function S(e=2){var t=Math.floor(Date.now()).toString(36);for(let i=0;i<e;i++)t+="-"+Math.floor(1e12*Math.random()).toString(36);return t}function C(e,t){let i=new Map;let a=function e(a){if("function"==typeof a){let e={},n=S();return t.set(n,a),i.set(e,n),e}if("object"==typeof a){if(Array.isArray(a))return a.map(e);{let t={};return Object.keys(a).forEach((i=>{t[i]=e(a[i])})),t}}return a}(e);return{result:a,fnMap:i}}const L=new FinalizationRegistry((({id:e,port:t})=>{t.postMessage({type:"rF",id:e})}));function F(e,t,i,a,n){let s=new Map;t.forEach(((e,t)=>{if(!s.has(e)){let t=(...t)=>new Promise(((s,o)=>{let r=C(t,a),l=S();a.set(l,s),n.set(l,o),i.postMessage({type:"fn",id:e,param:r.result,fnMap:r.fnMap.size>0?r.fnMap:void 0,cb:l})}));s.set(e,t),L.register(t,{id:e,port:i})}}));const o=e=>{if("object"==typeof e){if(t.has(e))return s.get(t.get(e));if(Array.isArray(e))return e.map(o);{let t={};return Object.keys(e).forEach((i=>{t[i]=o(e[i])})),t}}return e};return{result:o(e)}}class j{#e=null;#t=null;#i=!1;#a=new class{cbList=[];onceCbList=[];add(e){this.cbList.push(e)}addOnce(e){this.onceCbList.push(e)}remove(e){let t=this.cbList.indexOf(e);t>-1?this.cbList.splice(t,1):(t=this.onceCbList.indexOf(e),t>-1&&this.onceCbList.splice(t,1))}removeAll(){this.cbList=[],this.onceCbList=[]}trigger(e){this.cbList.forEach((t=>{t(e)})),this.onceCbList.forEach((t=>{t(e)})),this.onceCbList=[]}};apiObj={};#n=new Map;#s=new Map;constructor(){if(!("sandbox"in HTMLIFrameElement.prototype)||!Object.hasOwn(HTMLIFrameElement.prototype,"contentDocument"))throw"sandbox property are not supported";let e=document.createElement("iframe");e.sandbox.add("allow-scripts"),e.style.display="none",e.srcdoc=["<!DOCTYPE html>","<html>","<head>",'<meta charset="utf-8" />',"<title>iframe sandbox</title>",'<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />',"</head>","<body>","<script>",E,"<\/script>","</body>","</html>"].join("");let t=new MessageChannel,i=t.port1;i.addEventListener("message",(async e=>{let t=e.data;switch(t.type){case"ready":this.#i=!0,this.#a.trigger();break;case"fn":if(this.#n.has(t.id)){let e=t.fnMap?F(t.param,t.fnMap,i,this.#n,this.#s).result:t.param;try{let a=await this.#n.get(t.id)(...e);if(t.cb){let e=C(a,this.#n);i.postMessage({type:"sol",id:t.cb,param:[e.result],fnMap:e.fnMap.size>0?e.fnMap:void 0})}}catch(e){t.cb&&i.postMessage({type:"rej",id:t.cb,param:[e]})}}break;case"rF":this.#n.delete(t.id);break;case"sol":{let e=t.fnMap?F(t.param,t.fnMap,i,this.#n,this.#s).result:t.param;this.#n.has(t.id)&&this.#n.get(t.id)(...e),this.#n.delete(t.id),this.#s.delete(t.id);break}case"rej":this.#s.has(t.id)&&this.#s.get(t.id)(...t.param),this.#n.delete(t.id),this.#s.delete(t.id)}})),e.addEventListener("load",(()=>{if(!this.#i){if(e.contentDocument)throw"sandbox isolation failed";i.start(),e.contentWindow.postMessage("setMessagePort","*",[t.port2])}})),document.body.appendChild(e),this.#e=e,this.#t=i}async waitAvailable(){return new Promise(((e,t)=>{this.#i?e():this.#a.addOnce(e)}))}async execJs(e){this.#i||await this.waitAvailable();let t=C(this.apiObj,this.#n);this.#t.postMessage({type:"execJs",js:e,param:t.result,fnMap:t.fnMap.size>0?t.fnMap:void 0,paramList:["api"]})}get iframe(){return this.#e}}function O(e){let t=e.split(" ");return new b((e=>{t.forEach((t=>{e.element.classList.add(t)}))}))}function W(e){e.setStyle("transition","transform 50ms linear, text-shadow 150ms linear"),e.addEventListener("mousedown",(()=>{e.setStyle("transform","scale(0.95) translateY(2px)")})),e.addEventListener("mouseup",(()=>{e.setStyle("transform","")})),e.addEventListener("mouseenter",(()=>{e.setStyle("textShadow",`0 0 0.3em ${t.rgb(255,255,255,.5)}`),e.setStyle("transform","translateY(-1px)")})),e.addEventListener("mouseleave",(()=>{e.setStyle("textShadow",""),e.setStyle("transform","")}))}function z(e,i,a=!1,...n){return new Promise((s=>{var o=void 0,r=f({width:"100%",height:"100%",$position:"absolute",style:{userSelect:"none",backgroundColor:t.rgb(0,0,0,.7),alignItems:"center",justifyContent:"center",zIndex:"30001"},assembly:[e=>{e.animate([{opacity:.1},{opacity:1}],{duration:120})}],display:"flex",child:[{style:{border:"1px white solid",backgroundColor:t.rgb(255,255,255,.95),color:t.rgb(0,0,0),alignItems:"center",justifyContent:"center",flexFlow:"column",lineHeight:"35px",minHeight:"190px",minWidth:"280px",maxWidth:"95%",boxSizing:"border-box",padding:"20px",borderRadius:"7px",pointerEvents:"none"},assembly:[e=>{e.animate([{transform:"scale(0.9) translateY(-100px)"},{}],{duration:120}),setTimeout((()=>{e.setStyle("pointerEvents","auto")}),120)},e=>{o=e}],position$:"static",display:"flex",child:[{text:e},{text:i},...n,{text:"确定",assembly:[W],event:{click:()=>{l(),s(!0)}}},a?{text:"取消",assembly:[W],event:{click:()=>{l(),s(!1)}}}:null]}]});function l(){o.setStyle("pointerEvents","none"),o.animate([{},{transform:"scale(0.9) translateY(-100px)"}],{duration:120,fill:"forwards"}),r.animate([{opacity:1},{opacity:.1}],{duration:120,fill:"forwards"}),setTimeout((()=>{r.remove()}),120)}v.addChild(r)}))}function A(){let e=x.getElement([g("position","fixed"),g("top","0"),g("left","0"),g("zIndex","91000"),g("height","100%"),g("width","100%"),g("backgroundColor","rgba(255,255,255,0.8)"),[g("opacity","0.8"),g("backgroundColor","#303030"),g("width","100%"),g("boxShadow","0 0 1px rgb(0, 0, 0, 0.12), 0 1px 1px rgb(0, 0, 0, 0.24)"),g("zIndex","2"),g("fontFamily","md"),g("height","40px"),g("lineHeight","40px"),g("fontSize","26px"),g("padding","0 64px 0 24px"),g("whiteSpace","nowrap"),g("boxSizing","border-box"),g("position","relative"),g("color","#fff"),[g("fontSize","16px"),g("opacity","0.7"),g("fontWeight","bold"),g("marginLeft","24px"),g("height","100%"),g("lineHeight","40px"),g("display","inline"),g("verticalAlign","top"),"欢迎使用 iirose-Forge"]],[g("position","absolute"),g("width","100%"),g("top","40px"),g("bottom","40px"),[...[{title:"加载插件",text:"加载插件",icon:"puzzle",onClick:async()=>{let e=await async function(e,t,i=!1,a=""){var n=f({tagName:"input",assembly:[W],style:{textAlign:"center",margin:"15px"},attr:{value:a}});return await z(e,t,i,n)?n.element.value:void 0}("添加插件","请输入插件地址",!0);null!=e&&async function(e,t){let i=new j;await i.waitAvailable(),i.apiObj={iiroseForge:{}};let a=await(await fetch(t)).text();i.execJs(a)}(0,e)}},{title:"安装iiroseForge",text:"下次使用无需注入",icon:"puzzle",onClick:async()=>{!async function(){let e=await caches.open("v"),t=await(await caches.match("/")).text();if(t.indexOf(M)>-1)return;let i=t.indexOf("</body></html>");if(-1==i)return;let a=t.slice(0,i)+M+t.slice(i);await e.put("/",new Response(new Blob([a],{type:"text/html"}),{status:200,statusText:"OK"}))}(),z("安装iiroseForge","已完成")}},{title:"卸载iiroseForge",text:"下次启动清除iiroseForge",icon:"puzzle",onClick:async()=>{!async function(){let e=await caches.open("v"),t=await(await caches.match("/")).text(),i=t.indexOf(M);if(-1==i)return;let a=t.slice(0,i)+t.slice(i+M.length);await e.put("/",new Response(new Blob([a],{type:"text/html"}),{status:200,statusText:"OK"}))}(),z("卸载iiroseForge","已完成")}}].map((e=>[O("commonBox"),g("maxWidth","calc(100% - 24px)"),g("minWidth","355.2px"),g("minHeight","200px"),g("float","left"),g("boxShadow","0 0 1px rgb(0,0,0,0.12),0 1px 1px rgb(0,0,0,0.24)"),g("margin","24px 12px 0px 12px"),g("position","relative"),[O("commonBoxHead"),g("backgroundColor","rgba(255,255,255,0.2)"),g("color","rgba(0,0,0,0.4)"),g("height","100px"),g("width","100%"),g("display","flex"),g("justifyContent","center"),g("padding","0 24px"),g("boxSizing","border-box"),[O("mdi-"+e.icon),g("lineHeight","100px"),g("fontSize","30px"),g("fontFamily","md"),g("display","inline-block"),g("verticalAlign","top"),g("height","100%"),g("opacity","0.7")],[g("lineHeight","100px"),g("fontSize","20px"),g("display","inline-block"),g("verticalAlign","top"),g("height","100%"),g("fontWeight","bold"),g("marginLeft","22px"),g("overflow","hidden"),g("whiteSpace","pre"),g("textOverflow","ellipsis"),e.title]],[O("textColor"),g("width","100%"),g("minHeight","100px"),g("backgroundColor","rgba(255,255,255,0.5)"),g("color","rgba(0,0,0,0.75)"),[g("fontWeight","bold"),g("width","100%"),g("height","100%"),g("lineHeight","1.8em"),g("textAlign","center"),g("padding","2.2em"),g("boxSizing","border-box"),g("whiteSpace","pre-wrap"),g("fontSize","16px"),g("color","rgba(0,0,0,0.7)"),e.text]],new m("click",e.onClick)]))]],[g("color","#303030"),g("background","#fff"),g("opacity",".8"),g("display","flex"),g("height","40px"),g("position","absolute"),g("bottom","0"),g("width","100%"),g("boxShadow","0 0 1px rgb(0,0,0,0.12),0 1px 1px rgb(0,0,0,0.24)"),g("zIndex","2"),...[{text:"< 返回",onClick:()=>{e.remove()}}].map((e=>[g("width","0"),g("flexGrow","1"),g("justifyContent","center"),g("padding","0 24px"),g("boxSizing","border-box"),new m("click",e.onClick),[],[g("display","inline-block"),g("verticalAlign","top"),g("height","100%"),g("fontWeight","bold"),g("marginLeft","22px"),g("fontSize","14px"),g("lineHeight","40px"),g("overflow","hidden"),g("whiteSpace","pre"),g("textOverflow","ellipsis"),e.text]]))]]);return e.element.id="iiroseForgeMenu",e}function H(){!function(e,t,i=!1){let a=0,n=Date.now(),s=null,o=()=>{a++;try{return e(a,Date.now()-n),void(null!=s&&clearInterval(s))}catch(e){}};s=setInterval(o,t),i&&o()}((()=>{let t=document.getElementById("mainFrame"),i=t.contentWindow,a=t.contentDocument;if(!i.iiroseForgeInjected){if(null!=i.socket.__onmessage||null==i.socket._onmessage||null==i.socket._send)throw"main iframe is not ready";(()=>{let e=d(a.getElementById("functionHolder").childNodes[0]),t=function(){let e=x.getElement([g("background","#fff"),g("boxShadow","0 0 1px rgb(0,0,0,0.12),0 1px 1px rgb(0,0,0,0.24)"),g("position","relative"),g("zIndex","1"),g("color","#212121"),g("paddingLeft","16px"),g("paddingRight","56px"),g("transition","background-color 0.1s ease 0s, color 0.1s ease 0s"),g("cursor","url(images/cursor/2.cur), pointer"),g("width","100%"),g("height","56px"),g("boxSizing","border-box"),g("lineHeight","56px"),g("whiteSpace","nowrap"),new m("click",(()=>{k.iframeWindow?.functionHolderDarker?.click(),k.iframeBody.addChild(A())})),[new w("span"),new b((e=>e.element.classList.add("functionBtnIcon","mdi-anvil")))],[new w("span"),"Forge菜单",new b((e=>e.element.classList.add("functionBtnFont")))],[new w("span"),g("transform","rotate(-90deg)"),new b((e=>e.element.classList.add("functionBtnGroupIcon")))]]);return e.element.id="iiroseForgeMenuButton",e}();e.insChild(t,1)})(),k.iframeDocument=a,k.iframeWindow=i,k.iframeBody=d(a.body),k.socket=i.socket,k.socket._onmessage=e(k.socket._onmessage.bind(k.socket),(e=>{let t=e[0];return console.log("get data",t),!1})),k.socket.send=e(k.socket.send.bind(k.socket),(e=>{let t=e[0];return console.log("send data",t),!1})),i.iiroseForgeInjected=!0,console.log("[iiroseForge] 成功将iiroseForge注入iframe")}}),1e3)}class N{cbList=[];onceCbList=[];add(e){this.cbList.push(e)}addOnce(e){this.onceCbList.push(e)}remove(e){let t=this.cbList.indexOf(e);t>-1?this.cbList.splice(t,1):(t=this.onceCbList.indexOf(e),t>-1&&this.onceCbList.splice(t,1))}removeAll(){this.cbList=[],this.onceCbList=[]}trigger(e){this.cbList.forEach((t=>{t(e)})),this.onceCbList.forEach((t=>{t(e)})),this.onceCbList=[]}}const I={operation:{getUserName:()=>k.iframeWindow?.myself2?k.iframeWindow.myself2:null,getUserUid:()=>k.iframeWindow?.uid?k.iframeWindow.uid:null,getUserRoomId:()=>k.iframeWindow?.roomn?k.iframeWindow.roomn:null,getUserProfilePictureUrl:()=>k.iframeWindow?.avatar2&&k.iframeWindow?.avatarconv?k.iframeWindow.avatarconv(k.iframeWindow.avatar2):null,getUserInputColor:()=>k.iframeWindow?.inputcolorhex?k.iframeWindow.inputcolorhex:null,sendRoomMessage:e=>{(e=String(e))&&k.socketApi.send(JSON.stringify({m:e,mc:I.operation.getUserInputColor(),i:String(Date.now()).slice(-5)+String(Math.random()).slice(-7)}))},sendPrivateMessageSilence:(e,t)=>{e=String(e),(t=String(t))&&e&&k.socketApi.send(JSON.stringify({g:e,m:t,mc:I.operation.getUserInputColor(),i:String(Date.now()).slice(-5)+String(Math.random()).slice(-7)}))},sendPrivateMessage:(e,t)=>{if(e=String(e),!((t=String(t))&&e&&k.iframeWindow?.msgfetch&&k.iframeWindow?.Variable?.pmObjJson&&k.iframeWindow?.Utils?.service?.buildPmHelper))return;let i=k.iframeDocument.getElementById("moveinput"),a=i.value,n=k.iframeWindow.pmFull;i.value=t,k.iframeWindow.pmFull=!0,k.iframeWindow.Variable.pmObjJson?.[e]||k.iframeWindow.Utils.service.buildPmHelper(1,e,e),k.iframeWindow.msgfetch(0,k.iframeWindow.Variable.pmObjJson?.[e],e,""),k.iframeWindow.pmFull=n,i.value=a},sendSelfPrivateMessageSilence:e=>{I.operation.sendPrivateMessageSilence(I.operation.getUserUid(),e)},giveALike:(e,t="")=>{e=String(e),t=String(t),e&&k.socketApi.send(`+*${e}${t?" "+t:""}`)}},event:{roomMessage:new N,privateMessage:new N,selfPrivateMessage:new N}};if(window.iiroseForgeApi=I,"iirose.com"==location.host)if("/"==location.pathname)if(window.iiroseForgeInjected)console.log("[iiroseForge] 已阻止重复注入");else{console.log("[iiroseForge] iiroseForge已启用"),document.getElementById("mainFrame").addEventListener("load",(()=>{console.log("[iiroseForge] 已重载 正在将iiroseForge注入iframe"),H()})),console.log("[iiroseForge] 正在将iiroseForge注入iframe"),H(),window.iiroseForgeInjected=!0}else console.log("[iiroseForge] 已阻止注入 iiroseForge需要注入至根页面的主上下文中");else console.log("[iiroseForge] 已阻止注入 iiroseForge仅支持蔷薇花园(iirose.com)")}();
